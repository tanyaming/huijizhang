# JinBooks财务系统 - 数据库结构汇总

## 项目概述
JinBooks是一个企业级财务管理系统，基于Spring Boot + Vue3开发，支持多账套管理、凭证管理、报表生成等核心财务功能。

## 数据库信息
- 数据库名称: `jinbooks`
- 字符集: utf8mb4 / utf8mb3
- 数据库版本: MySQL 8.4.0
- 版本号: v1.0.1

---

## 数据库表分类汇总

### 一、核心业务模块 (Core Business)

#### 1. 账套管理 (Book Management)
| 表名 | 说明 | 核心字段 |
|------|------|---------|
| `jbx_book` | 账套表 | id, name, company_name, enable_date, standard_id, vat_type |
| `jbx_book_subject` | 账套科目表 | id, book_id, code, name, category, level |
| `jbx_book_init_balance` | 初始余额表 | id, book_id, code, balance, debit_amount, credit_amount |

#### 2. 凭证管理 (Voucher Management)
| 表名 | 说明 | 核心字段 |
|------|------|---------|
| `jbx_voucher` | 凭证记录表 | id, book_id, voucher_date, voucher_word, voucher_no, status |
| `jbx_voucher_item` | 凭证明细表 | id, voucher_id, subject_id, debit_amount, credit_amount |
| `jbx_voucher_auxiliary` | 凭证明细辅助核算关联表 | id, item_id, assist_id, assist_type |
| `jbx_voucher_item_cash_flow` | 凭证项现金流量关系表 | id, item_id, cash_flow_id, amount |
| `jbx_voucher_word` | 凭证字表 | id, book_id, word_name, word_code |
| `jbx_voucher_template` | 凭证模板表 | id, template_name, voucher_type |
| `jbx_voucher_template_item` | 凭证模板明细表 | id, template_id, subject_code |

#### 3. 审批流程 (Approval Process)
| 表名 | 说明 | 核心字段 |
|------|------|---------|
| `jbx_approval_record` | 审批记录表 | id, voucher_id, approver_id, status, comment |


### 二、财务报表模块 (Financial Statements)

#### 1. 报表数据 (Statement Data)
| 表名 | 说明 | 核心字段 |
|------|------|---------|
| `jbx_statement_balance_sheet` | 资产负债表 | id, book_id, period, total_assets, total_liabilities |
| `jbx_statement_balance_sheet_item` | 资产负债表-信息项配置 | id, balance_sheet_id, item_name, amount |
| `jbx_statement_income` | 利润表 | id, book_id, period, revenue, profit |
| `jbx_statement_income_item` | 利润表明细 | id, income_id, item_name, amount |
| `jbx_statement_cash_flow` | 现金流量表 | id, book_id, period, operating_cash_flow |
| `jbx_statement_subject_balance` | 科目余额表 | id, book_id, subject_id, opening_balance, closing_balance |
| `jbx_statement_rules` | 报表统计规则 | id, book_id, rule_name, formula |

#### 2. 报表模板 (Statement Templates)
| 表名 | 说明 | 核心字段 |
|------|------|---------|
| `jbx_standard_statement_balance_sheet` | 资产负债表模板 | id, standard_id, item_name, item_code |
| `jbx_standard_statement_income` | 准则利润表模板 | id, standard_id, item_name, item_code |
| `jbx_standard_statement_rules` | 报表统计规则模板 | id, standard_id, rule_name, formula |

### 三、辅助核算模块 (Auxiliary Accounting)

| 表名 | 说明 | 核心字段 |
|------|------|---------|
| `jbx_assist_acc` | 辅助核算项目表 | id, book_id, assist_type, assist_code, assist_name |
| `jbx_customer` | 客户表 | id |

**辅助核算类型说明:**
- 类型1: 项目
- 类型2: 客户
- 类型3: 供应商
- 类型4: 部门
- 类型5: 员工
- 类型6: 存货

### 四、人力资源模块 (Human Resources)

#### 1. 员工管理 (Employee Management)
| 表名 | 说明 | 核心字段 |
|------|------|---------|
| `jbx_employee` | 员工表 | id, display_name, dept_id, post_id, status |
| `jbx_employee_tax_deduction` | 税务扣除表 | id, book_id, employee_id, deduction_amount |

#### 2. 薪资管理 (Salary Management)
| 表名 | 说明 | 核心字段 |
|------|------|---------|
| `jbx_employee_salary` | 工资明细表 | id, employee_id, salary_month, base_salary, personal_tax |
| `jbx_employee_salary_temp` | 工资明细临时表 | id, employee_id, base_salary, allowance |
| `jbx_employee_salary_summary` | 工资汇总表 | id, label, salary_month, total_amount |
| `jbx_employee_salary_voucher_rule` | 工资凭证规则表 | id, summary, subject_code, amount_type |
| `jbx_employee_salary_voucher_rule_template` | 工资凭证规则模板表 | id, voucher_type, template_name |


### 五、日记账模块 (Journal)

| 表名 | 说明 | 核心字段 |
|------|------|---------|
| `jbx_journal_account` | 账户表 | id, book_id, account_name, account_type |
| `jbx_journal_entry` | 日记账表 | id, book_id, entry_date, amount, description |
| `jbx_journal_summary` | 收支汇总表 | id, book_id, period, income, expense |

### 六、结账模块 (Settlement)

| 表名 | 说明 | 核心字段 |
|------|------|---------|
| `jbx_settlement` | 结账表 | id, book_id, period, status, settlement_date |
| `jbx_settlement_carryforward` | 结转凭证关联表 | id, settlement_id, voucher_id |

### 七、系统配置模块 (System Configuration)

#### 1. 基础配置 (Basic Configuration)
| 表名 | 说明 | 核心字段 |
|------|------|---------|
| `jbx_config` | 参数配置表 | config_id, book_id, config_name, config_value |
| `jbx_standard` | 会计准则模板表 | id, standard_name, standard_code |
| `jbx_standard_subject` | 记账科目表 | id, standard_id, code, name, category |
| `jbx_standard_subject_cash_flow` | 科目现金流量关系表 | id, subject_id, cash_flow_id |

#### 2. 财务配置 (Financial Configuration)
| 表名 | 说明 | 核心字段 |
|------|------|---------|
| `jbx_config_cash_flow_balance` | 现金流量配置表 | id, item_name, formula, direction |
| `jbx_config_personal_tax` | 税率表 | id, level, min_income, max_income, tax_rate |
| `jbx_config_salary_formula` | 薪资计算公式表 | id, rule_name, formula, description |
| `jbx_config_insurance_fund` | 社保公积金配置表 | id, pay_base, pension_rate, medical_rate |

#### 3. 通信配置 (Communication Configuration)
| 表名 | 说明 | 核心字段 |
|------|------|---------|
| `jbx_config_email_senders` | 邮箱配置表 | id, smtp_host, smtp_port, username |
| `jbx_config_sms_provider` | 短信网关配置表 | id, provider, api_key, api_secret |

#### 4. 安全配置 (Security Configuration)
| 表名 | 说明 | 核心字段 |
|------|------|---------|
| `jbx_config_login_policy` | 登录策略表 | id, session_validity, max_attempts |
| `jbx_config_password_policy` | 密码策略表 | id, min_length, require_uppercase, expire_days |

### 八、权限管理模块 (Permission Management)

#### 1. 用户与组织 (Users & Organizations)
| 表名 | 说明 | 核心字段 |
|------|------|---------|
| `jbx_userinfo` | 用户表 | id, username, display_name, email, mobile |
| `jbx_organizations` | 组织部门表 | id, org_code, org_name, parent_id, level |
| `jbx_institutions` | 机构表(多租户) | id, inst_name, inst_code, status |

#### 2. 角色与权限 (Roles & Permissions)
| 表名 | 说明 | 核心字段 |
|------|------|---------|
| `jbx_roles` | 角色表 | id, role_code, role_name, description |
| `jbx_role_member` | 角色成员表 | id, role_id, user_id |
| `jbx_permission` | 权限-组表 | id, role_id, resource_id |
| `jbx_permission_book` | 用户账套权限表 | id, user_id, book_id, permission_type |
| `jbx_resources` | 资源表 | id, res_name, res_type, res_url |


### 九、会话管理模块 (Session Management)

| 表名 | 说明 | 核心字段 |
|------|------|---------|
| `jbx_session_list` | 会话表 | id, user_id, session_id, login_time, last_access_time |
| `jbx_scheduled_lock` | 定时任务锁表 | id, lock_name, lock_status, lock_time |

### 十、社交登录模块 (Social Login)

| 表名 | 说明 | 核心字段 |
|------|------|---------|
| `jbx_socials_provider` | 社交提供商表 | id, provider_name, client_id, client_secret |
| `jbx_socials_associate` | 社交账号关联表 | id, user_id, provider, social_user_id |

### 十一、日志与历史记录模块 (Logs & History)

| 表名 | 说明 | 核心字段 |
|------|------|---------|
| `jbx_history_login` | 系统登录日志表 | id, category, user_id, login_time, ip_address |
| `jbx_history_event` | 系统事件记录表 | id, event_name, event_type, event_time |
| `jbx_history_system_logs` | 系统操作日志表 | id, topic, operation, user_id, log_time |
| `jbx_history_synchronizer` | 同步器日志表 | id, sync_id, sync_status, sync_time |

### 十二、文件管理模块 (File Management)

| 表名 | 说明 | 核心字段 |
|------|------|---------|
| `jbx_file_storage` | 文件上传表 | id, file_name, file_path, file_size, upload_time |

---

## 数据库表统计

### 按模块分类统计

| 模块 | 表数量 | 说明 |
|------|--------|------|
| 核心业务模块 | 10 | 账套、凭证、审批 |
| 财务报表模块 | 10 | 资产负债表、利润表、现金流量表等 |
| 辅助核算模块 | 2 | 辅助核算项目、客户 |
| 人力资源模块 | 7 | 员工、薪资管理 |
| 日记账模块 | 3 | 账户、日记账、收支汇总 |
| 结账模块 | 2 | 结账、结转 |
| 系统配置模块 | 11 | 基础配置、财务配置、通信配置、安全配置 |
| 权限管理模块 | 8 | 用户、组织、角色、权限 |
| 会话管理模块 | 2 | 会话、定时任务锁 |
| 社交登录模块 | 2 | 社交提供商、账号关联 |
| 日志历史模块 | 4 | 登录日志、事件日志、操作日志、同步日志 |
| 文件管理模块 | 1 | 文件存储 |
| **总计** | **62** | **所有数据库表** |


---

## 核心业务流程

### 1. 凭证录入流程
```
创建凭证 (jbx_voucher) 
  ↓
添加凭证明细 (jbx_voucher_item)
  ↓
关联辅助核算 (jbx_voucher_auxiliary) [可选]
  ↓
关联现金流量 (jbx_voucher_item_cash_flow) [可选]
  ↓
提交审批 (jbx_approval_record)
  ↓
审批通过后记账
```

### 2. 报表生成流程
```
科目余额汇总 (jbx_statement_subject_balance)
  ↓
应用报表规则 (jbx_statement_rules)
  ↓
生成资产负债表 (jbx_statement_balance_sheet)
生成利润表 (jbx_statement_income)
生成现金流量表 (jbx_statement_cash_flow)
```

### 3. 薪资处理流程
```
导入员工薪资 (jbx_employee_salary_temp)
  ↓
计算个税 (jbx_config_personal_tax)
  ↓
生成正式薪资 (jbx_employee_salary)
  ↓
汇总薪资数据 (jbx_employee_salary_summary)
  ↓
应用凭证规则 (jbx_employee_salary_voucher_rule)
  ↓
生成薪资凭证 (jbx_voucher)
```

### 4. 结账流程
```
检查凭证审核状态
  ↓
生成结转凭证 (jbx_settlement_carryforward)
  ↓
更新科目余额 (jbx_statement_subject_balance)
  ↓
创建结账记录 (jbx_settlement)
  ↓
锁定当期凭证
```

---

## 关键字段说明

### 通用字段
- `id`: 主键，varchar(45) 或 varchar(50)
- `created_by`: 创建人ID
- `created_date`: 创建时间
- `modified_by`: 修改人ID
- `modified_date`: 修改时间
- `deleted`: 删除标记 ('y'/'n')

### 财务相关字段
- `book_id`: 账套ID，关联 jbx_book 表
- `debit_amount`: 借方金额，decimal(10,2)
- `credit_amount`: 贷方金额，decimal(10,2)
- `balance`: 余额，decimal(10,2)
- `subject_id`: 科目ID
- `subject_code`: 科目编码

### 状态字段
- `status`: 状态标识
  - 凭证状态: 0-草稿, 1-待审核, 2-已审核
  - 审批状态: PENDING-待审批, APPROVED-已通过, REJECTED-已拒绝
  - 结账状态: 0-未结账, 1-已结账


---

## 数据库设计特点

### 1. 多租户架构
- 通过 `jbx_institutions` 表实现多租户隔离
- 大部分业务表通过 `book_id` 实现账套级别的数据隔离

### 2. 软删除机制
- 所有业务表都包含 `deleted` 字段 ('y'/'n')
- 删除操作不物理删除数据，仅标记为已删除

### 3. 审计追踪
- 完整的创建和修改信息记录
- 详细的操作日志表 (jbx_history_*)
- 登录日志和事件日志

### 4. 灵活的辅助核算
- 支持6种辅助核算类型（项目、客户、供应商、部门、员工、存货）
- 通过 `jbx_voucher_auxiliary` 实现凭证与辅助核算的多对多关联

### 5. 模板化设计
- 会计准则模板 (jbx_standard_*)
- 凭证模板 (jbx_voucher_template)
- 报表模板 (jbx_standard_statement_*)
- 薪资凭证规则模板

### 6. 现金流量管理
- 科目与现金流量项目关联 (jbx_standard_subject_cash_flow)
- 凭证明细与现金流量关联 (jbx_voucher_item_cash_flow)
- 现金流量配置规则 (jbx_config_cash_flow_balance)

---

## 数据库版本变更 (v1.0.1-add.sql)

### 新增字段
1. **薪资表增加应发工资字段**
   - `jbx_employee_salary_temp.pay_amount`
   - `jbx_employee_salary.pay_amount`
   - `jbx_employee_salary_summary.pay_amount`

2. **凭证模板增加日期字段**
   - `jbx_voucher_template.voucher_date`: 默认凭证日期

3. **科目余额表增加上月数据字段**
   - `jbx_statement_subject_balance.prev_balance`: 上月末余额
   - `jbx_statement_subject_balance.prev_closing_balance_debit`: 上月期末余额(借方)
   - `jbx_statement_subject_balance.prev_closing_balance_credit`: 上月期末余额(贷方)
   - `jbx_statement_subject_balance.prev_year_to_date_debit`: 上月本年累计(借方)
   - `jbx_statement_subject_balance.prev_year_to_date_credit`: 上月本年累计(贷方)

4. **薪资表增加凭证关联字段**
   - `jbx_employee_salary.accrual_voucher_id`: 计提凭证编码
   - `jbx_employee_salary.salary_voucher_id`: 发放凭证编码

### 删除字段
- `jbx_employee_salary_summary.salary_voucher_id`
- `jbx_employee_salary_summary.accrual_voucher_id`

### 删除表
- `jbx_employee_salary_voucher_rule_template`: 工资凭证规则模板表
- `jbx_employee_salary_voucher_rule`: 工资凭证规则表

### 字段修改
- `jbx_voucher_item.subject_balance`: 修改为 decimal(10,2)

---

## 数据库优化建议

### 1. 索引优化
建议为以下字段添加索引以提升查询性能：
- `jbx_voucher.book_id, voucher_date`
- `jbx_voucher_item.voucher_id, subject_id`
- `jbx_statement_subject_balance.book_id, period`
- `jbx_employee_salary.employee_id, salary_month`
- `jbx_history_login.user_id, login_time`

### 2. 分区建议
对于历史数据量大的表，建议按时间分区：
- `jbx_history_login`: 按月分区
- `jbx_history_system_logs`: 按月分区
- `jbx_voucher`: 按年分区

### 3. 归档策略
建议定期归档历史数据：
- 登录日志保留1年
- 操作日志保留2年
- 已结账凭证按年度归档

---

## 总结

JinBooks财务系统数据库设计完整、规范，涵盖了企业财务管理的核心功能：

✅ **完整的会计核算体系**: 支持多账套、多准则、辅助核算
✅ **灵活的报表系统**: 资产负债表、利润表、现金流量表、科目余额表
✅ **强大的权限管理**: 多租户、角色权限、账套权限
✅ **完善的审计追踪**: 操作日志、登录日志、事件日志
✅ **人力资源集成**: 薪资管理、个税计算、凭证自动生成
✅ **模板化设计**: 支持自定义会计准则、凭证模板、报表规则

数据库表总数: **62张表**
支持功能模块: **12个主要模块**

---

**文档生成时间**: 2026-02-13  
**数据库版本**: v1.0.1  
**文档版本**: 1.0
